<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"harperchen.github.io","root":"/blog/","images":"/blog/images","scheme":"Gemini","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/blog/js/config.js"></script>

    <meta name="description" content="Several CasesThe following cases are concluded by the inspection of summaries&#x2F;specifications generated by several tools.  Android and Java Summaries: StubDroid, Modelgen, Apposcopy Javascript Sum">
<meta property="og:type" content="article">
<meta property="og:title" content="Taint-Specifications">
<meta property="og:url" content="https://harperchen.github.io/blog/2020/09/30/Taint-Specifications/index.html">
<meta property="og:site_name" content="Wei&#39;s Blog">
<meta property="og:description" content="Several CasesThe following cases are concluded by the inspection of summaries&#x2F;specifications generated by several tools.  Android and Java Summaries: StubDroid, Modelgen, Apposcopy Javascript Sum">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-09-30T06:51:24.000Z">
<meta property="article:modified_time" content="2024-03-27T05:21:36.071Z">
<meta property="article:author" content="Wei CHEN">
<meta property="article:tag" content="Taint Analysis">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://harperchen.github.io/blog/2020/09/30/Taint-Specifications/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://harperchen.github.io/blog/2020/09/30/Taint-Specifications/","path":"2020/09/30/Taint-Specifications/","title":"Taint-Specifications"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Taint-Specifications | Wei's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Wei's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Several-Cases"><span class="nav-number">1.</span> <span class="nav-text">Several Cases</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Wei CHEN"
      src="/blog/images/8.jpg">
  <p class="site-author-name" itemprop="name">Wei CHEN</p>
  <div class="site-description" itemprop="description">Be Brave; Be Confident; <br> Be Happy; Be Optimistic; </div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog/archives/">
          <span class="site-state-item-count">60</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/blog/tags/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/harperchen" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;harperchen" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:harperchen1110@gmail.com" title="E-Mail → mailto:harperchen1110@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harperchen.github.io/blog/2020/09/30/Taint-Specifications/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/8.jpg">
      <meta itemprop="name" content="Wei CHEN">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wei's Blog">
      <meta itemprop="description" content="Be Brave; Be Confident; <br> Be Happy; Be Optimistic; ">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Taint-Specifications | Wei's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Taint-Specifications
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-30 14:51:24" itemprop="dateCreated datePublished" datetime="2020-09-30T14:51:24+08:00">2020-09-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-27 13:21:36" itemprop="dateModified" datetime="2024-03-27T13:21:36+08:00">2024-03-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Taint/" itemprop="url" rel="index"><span itemprop="name">Taint</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h4 id="Several-Cases"><a href="#Several-Cases" class="headerlink" title="Several Cases"></a>Several Cases</h4><p>The following cases are concluded by the inspection of summaries&#x2F;specifications generated by several tools.</p>
<ul>
<li>Android and Java Summaries: StubDroid, Modelgen, Apposcopy</li>
<li>Javascript Summaries: Taser</li>
</ul>
<ol>
<li><p><strong>How to decide Input and Output</strong></p>
<p>Basically, the inputs and outputs of a method are not only the parameters and return values, especially for those methods that take function callback as parameters. </p>
<span id="more"></span>

<p>The taint source can be parameters, <code>this</code> reference for instance methods, and all visiable static fields.</p>
<p>The taint sink can be return value, parameters, also the <code>this</code> reference for instance methods.</p>
<p>The following summary are generated by <code>StubDroid</code> for method <code>writeObject</code> in class <code>java.io.ObjectOutputStream</code>. The data flows from the first parameter to the field <code>innerStream</code> with type <code>java.io.OutputStream</code>of <code>this</code> reference.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">method</span> <span class="attr">id</span>=<span class="string">&quot;void writeObject(java.lang.Object)&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">flows</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">flow</span> <span class="attr">isAlias</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">from</span> <span class="attr">sourceSinkType</span>=<span class="string">&quot;Parameter&quot;</span> <span class="attr">ParameterIndex</span>=<span class="string">&quot;0&quot;</span> /&gt;</span>  <span class="comment">&lt;!--the first parameter object--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">to</span> <span class="attr">sourceSinkType</span>=<span class="string">&quot;Field&quot;</span> <span class="attr">AccessPath</span>=<span class="string">&quot;[java.io.ObjectOutputStream: java.io.OutputStream innerStream]&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">AccessPathTypes</span>=<span class="string">&quot;[java.io.OutputStream]&quot;</span> /&gt;</span>  <span class="comment">&lt;!--the impact to outputstream--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">flow</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">flows</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">method</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>To test the correctness of this summary, we need to detect the field and check its value. A test example is shown as below. The object <code>oos</code> takes output stream <code>out</code> as parameter of constructor, then invokes  <code>writeObject</code> to write data to <code>out</code> via an internal field reference. To detect such implicit information flow, the summaries need to specify that the call to <code>oos.writeObject</code> has an implicit side-effect on <code>out</code>. So we treat <code>out</code> as the output of the summary and the parameter of <code>writeObject</code> as the input.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">OutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line"><span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(out);</span><br><span class="line">oos.writeObject(<span class="string">&quot;1234&quot;</span>);</span><br><span class="line">oos.close();</span><br><span class="line">System.out.println(out.toString());</span><br></pre></td></tr></table></figure>

<p>Similarly, Apposcopy manually writes the following specification to simulate the behavior of <code>writeObject</code> related to the data flow.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@STAMP(flows = &#123;@Flow(from = &quot;object&quot;, to = &quot;!this&quot;)&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">writeObject</span><span class="params">(Object object)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    ObjectInputStream.object = object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When testing such summaries, the output is no longer restricted to the method itself. We need to deal with the output case by case and further monitor the if the output changes with different inputs. </p>
<p>Further, due to the dynamic feature, it’s even more complex to determine the input and output for method in Javascript. Please find the examples in Section 5.</p>
</li>
<li><p><strong>Taint source in summary may not be sound</strong></p>
</li>
</ol>
<p>   The taint source specified by the generated summaries may not be sound. So it’s not enough to only focus on the mutation of the source in summary,  other potential source should also be taken into consideration.</p>
<ol start="3">
<li><p><strong>Implicit Effect on the Output</strong></p>
<p>Something like index, offset, will effect the output, but will not be counted as taint source. The following method  <code>&lt;java.io.BufferedReader: int read(char[],int,int)&gt;</code> reads characters into a portion of an array. The second parameter offset is used to specify at which to start storing characters. Obvoiusly, offset decides the final content of array <code>a</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @param      cbuf  Destination buffer</span></span><br><span class="line"><span class="comment"> * @param      off   Offset at which to start storing characters</span></span><br><span class="line"><span class="comment"> * @param      len   Maximum number of characters to read</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return     The number of characters read, or -1 if the end of the</span></span><br><span class="line"><span class="comment"> *             stream has been reached</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @exception  IOException  If an I/O error occurs</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">read</span><span class="params">(<span class="type">char</span> cbuf[], <span class="type">int</span> off, <span class="type">int</span> len)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Below shows one usage of read method */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">char</span> []a = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">50</span>];</span><br><span class="line">        Arrays.fill(a, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(System.in));</span><br><span class="line">        bufferedReader.read(a, <span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e)&#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The specification&#x2F;summary generated by several work are listed as below. All of them don’t mark arg#2 offset as taint source. The summaries are correct because the <code>index</code> or <code>offset</code> are just data position, not data itself. But it’s not consistent with our idea.</p>
<ul>
<li>Modelgen: arg#3-&gt;this; this-&gt;return; this-&gt;arg#1; arg#3-&gt;return; arg#3-&gt;arg#1; </li>
<li>Mannually written summay of Apposcopy</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@STAMP(flows = &#123;@Flow(from = &quot;this&quot;, to = &quot;buffer&quot;),     // this-&gt;arg#1;</span></span><br><span class="line"><span class="meta">                @Flow(from = &quot;length&quot;, to = &quot;buffer&quot;),   // arg#3-&gt;arg#1;</span></span><br><span class="line"><span class="meta">                @Flow(from = &quot;length&quot;, to = &quot;this&quot;),     // arg#3-&gt;this;</span></span><br><span class="line"><span class="meta">                @Flow(from = &quot;length&quot;, to = &quot;@return&quot;)&#125;)</span> <span class="comment">// arg#3-&gt;return; </span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">read</span><span class="params">(<span class="type">char</span>[] buffer, <span class="type">int</span> offset, <span class="type">int</span> length)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">  	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>StubDroid:  This summary means data flows from field <code>innerReader</code> to the first parameter <code>buffer</code>.</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">method</span> <span class="attr">id</span>=<span class="string">&quot;int read(char[],int,int)&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">flows</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">flow</span> <span class="attr">isAlias</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">from</span> <span class="attr">sourceSinkType</span>=<span class="string">&quot;Field&quot;</span> <span class="attr">AccessPath</span>=<span class="string">&quot;[java.io.BufferedReader: java.io.Reader innerReader]&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">AccessPathTypes</span>=<span class="string">&quot;[java.io.Reader]&quot;</span> /&gt;</span>  <span class="comment">&lt;!-- java.io.Reader is the private field of bufferedReader --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">to</span> <span class="attr">sourceSinkType</span>=<span class="string">&quot;Parameter&quot;</span> <span class="attr">ParameterIndex</span>=<span class="string">&quot;0&quot;</span> /&gt;</span>  <span class="comment">&lt;!-- parameter 0 is the first parameter buffer --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">flow</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">flows</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">method</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Different Granularity</strong></p>
<p>Different summaries generated by different tools have different granularities. The summaries generated by StubDroid and Taser are field-sensitive, but modelgen only consider <code>this</code> reference instead of distinguishing different fields. StubDriod even defines the access path to deal with the case like <code>a.b.c</code>.</p>
</li>
<li><p><strong>CallBack</strong></p>
<p>JavaScript libraries interact with their application code in complex ways, e.g., through callbacks, or by allowing plugins to be configured inside the library. Therefore, it is non-trivial to determine where the library code starts and where the client code ends.  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> userInput = &#123;</span><br><span class="line">    <span class="attr">tempDir</span>: <span class="string">&quot;./path/to/dir&quot;</span>,</span><br><span class="line">    <span class="attr">cacheDir</span>: <span class="string">&quot;./path/to/cache&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">&quot;lodash&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> rimraf = <span class="built_in">require</span>(<span class="string">&quot;rimraf&quot;</span>);</span><br><span class="line"><span class="comment">// _.forIn(object, [iteratee=_.identity])</span></span><br><span class="line"><span class="comment">// iteratee has three paras (value, key, object).</span></span><br><span class="line"><span class="keyword">let</span> obj = _.<span class="title function_">forIn</span>(userInput, <span class="keyword">function</span>(<span class="params">value</span>) &#123;  <span class="comment">// iteratee</span></span><br><span class="line">    <span class="title function_">rimraf</span>(value, <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>This code fragment uses two of the most popular npm packages: lodash, a general-purpose utility library, and rimraf, a simple library for recursively deleting directories on the disk. In this example, the forIn method from lodash is used to iterate through the values of each property on the <code>userInput</code> object. Each of these values is then passed to the <code>rimraf</code> module. The tool Taser generates several summaries for the forIn method, also marks the first parameter of <code>rimraf</code> method as additional sink, due to <code>rimraf</code> may be controlled by attracker to delete arbitrary directory of server.</p>
<table>
<thead>
<tr>
<th>ID</th>
<th align="center">In</th>
<th align="center">Out</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td align="center">(parameter 0 (member forIn (root lodash))) [userInput]</td>
<td align="center">(parameter 1 (parameter 1 (member forIn (root lodash))))      [iteratee.key]</td>
</tr>
<tr>
<td>2</td>
<td align="center">(parameter 0 (member forIn (root lodash)))                                    [userInput]</td>
<td align="center">(parameter 2 (parameter 1 (member forIn (root lodash))))                             [ieteratee.iterable(userInput)]</td>
</tr>
<tr>
<td>3</td>
<td align="center">(parameter 0 (member forIn (root lodash))) [userInput]</td>
<td align="center">(return (member forIn (root lodash)))  [obj]</td>
</tr>
<tr>
<td>4</td>
<td align="center">(member * (parameter 0 (member forIn (root lodash))))   [userInput.*]</td>
<td align="center">(parameter 0 (parameter 1 (member forIn (root lodash))))          [iteratee.value]</td>
</tr>
<tr>
<td>5</td>
<td align="center">(parameter 0 (root rimraf))) [value]</td>
<td align="center">Sink</td>
</tr>
</tbody></table>
<p>The data flows from user code to library code (via parameter 0 of forIn), then back to the user code due to the exists of callback (via parameter 1 of forIn), next enter library code (via parameter 0 of rimraf) and finally back to the user code (via return value obj). To test these summaries, we need to write test case like below.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">&quot;lodash&quot;</span>);</span><br><span class="line">  </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">a</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">b</span> = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">retObj = _.<span class="title function_">forIn</span>(<span class="keyword">new</span> <span class="title class_">Foo</span>, <span class="keyword">function</span>(<span class="params">value, key, object</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key);   <span class="comment">// test summary 1</span></span><br><span class="line">    <span class="title function_">diff</span>(object, <span class="title class_">Foo</span>);  <span class="comment">// test summary 2</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value); <span class="comment">// test summary 4</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">diff</span>(retObj, <span class="title class_">Foo</span>)  <span class="comment">// test summary 3</span></span><br></pre></td></tr></table></figure>

<p>In this case, we need to customize our callback to check if the output of the library method changes.</p>
</li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/Taint-Analysis/" rel="tag"># Taint Analysis</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/blog/2020/09/30/Tech-Taint-Specifications/" rel="prev" title="[Tech] Taint-Specifications">
                  <i class="fa fa-angle-left"></i> [Tech] Taint-Specifications
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/blog/2020/12/18/USENIX-17-kAFL-Hardware-Assisted-Feedback-Fuzzing-for-OS-Kernels/" rel="next" title="[USENIX'17] kAFL: Hardware-Assisted Feedback Fuzzing for OS Kernels">
                  [USENIX'17] kAFL: Hardware-Assisted Feedback Fuzzing for OS Kernels <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Wei CHEN</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/blog/js/comments.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/next-boot.js"></script>

  






  





</body>
</html>
